## 1.비동기 프로그래밍
### 1-2 자바스크립트는 동기? 비동기?
자바스크립트는 기본적으로 하나의 태스크 만을 실행할 수 있는 __싱글스레드__ 기반의 언어입니다.
그렇기 때문에 __동기적__(함수가 호출된 순서대로 실행되는 구조)으로 프로그램이 실행이 되며 앞선 함수에 대한 작업이 진행되고 있는 동안
뒤에 위치한 코드(함수)들은 __블로킹__(작업중단)이 일어나게 됩니다.

이러한 동기적인 방식은 순서대로 실행되기 때문에 __실행순서를 보장할 수 있다는 장점__ 이 있지만 앞서 말한 것처럼 __블로킹이 발생하는 단점__ 도 존재합니다.

<br>

### 1-2 그럼 자바스크립트에서는 비동기 작업이 불가능하나요?
그렇지 않습니다. 자바스크립트에서도 setTimeout, setInterval, 이벤트핸들링, Promise등을 통해서 __비동기적__ 으로 프로그래밍을 할 수 있습니다.
이러한 비동기 작업을 설명하기 위해서는 __브라우저__ 의 환경에 대해서 조금 설명을 할 필요가 있습니다.

<br>


### 1-3 자바스크립트의 비동기를 이해하기 위한 브라우저 환경
사진


브라우저에는 __자바스크립트 엔진__ 뿐만 아니라 __테스크큐, Web API, 이벤트 루프__ 등이 존재합니다. 우선 __자바스크립트 엔진__ 은 크게 2개의 영역으로 구분할 수 있습니다.

1. __콜스택__: 실행컨텍스트들이 추가,제거 되는 스택 자료구조형식의 공간입니다. 최상위의 실행컨텍스트가 제거되기 전까지는 다른 어떤 태스크도 실행되지 않습니다.
2. __힙__: 객체가 저장 되어지는 메모리 공간이며 이 곳의 객체를 실행컨텍스트가 참조하게 됩니다. 객체는 원시값과는 다르게 메모리 공간이 정해져 있지 않음으로 항상 런타임환경에 동적할당 됩니다.. 구조화되어 있지 않다는 특징이 있습니다.

이처럼 지금까지 이야기한 자바스크립트 엔진은 비동기적인 처리를 위해 어떠한 기능도 하지 않습니다. 오로지 싱글스레드 기반으로 콜스택과 힙을 이용하여 함수의 평가와 실행만을 할 뿐입니다.

> 그럼 앞서 말한 __비동기 프로그래밍__ 을 위한 작업은 어디에서 담당을 하는 걸까요?

바로 브라우저, Node.js에서 담당을 하게 됩니다. 브라우저에서는 비동기 처리의 __호출 타이머 설정,__ __콜백 함수의 등록__ 등의 역활을 수행하게 됩니다. 이를 위해서 브라우저는 __태스크 큐__ 와 __이벤트 루프__ 를 내장하고 있으며 이를 제공합니다.

1. __태스크 큐, 마이크로큐__: setTimeout, setInterval과 같은 비동기 함수의 콜백함수, 이벤트 핸들러 등이 일시적으로 보관되어지는 영역이라고 할 수 있습니다.
  Promise의 후속처리 메서드의 콜백 함수가 일시적으로 보관되는 __마이크로 큐__ 라는 공간도 존재합니다.
2. __이벤트 루프__: 콜 스택에 실행컨텍스트가 존재하는지, 태스크 큐에 대기중인 함수(콜백, 이벤트 핸들러)가 존재하는지를 반복해서 확인합니다. __ 콜스택에 실행 컨텍스트가 존재하지 않고
태스크 큐에는 대기중인 함수가 존재할 경우 태스크 큐(대기중인 함수) -> 콜스택(실행컨텍스트)로 이동시킵니다.

```js
const sayHello = () => { console.log('Hello~') };
const sayBye = () => { console.log('Bye...') };

const test = (callback) => {
  setTimeout(callback, 0)
}

test(sayBye)
sayHello()

// Hello~ 
// 최소단위 4ms 후 Bye... 출력
```

해당 코드의 경우를 보았을 떄 test 함수의 callback 함수로 sayBye가 전달되어 실행 컨텍스트가 생성되고 콜스택에 담겨지게 되었지만 뒤에 호출한 sayHello 함수의 "Hello~"가 먼저 출력되는 것을 볼 수 있습니다. 아래와 같이 동작 되어지기 때문입니다.

    1. 전역 코드 평가 -> 전역 실행 컨텍스트 생성 -> 콜스택 push
    2. test함수 평가 -> test 함수 실행 컨텍스트 생성 -> 콜스택 push -> setTimeout 함수 평가 -> setTimeout 함수 실행 컨텍스트 생성 (setTimeout은 Web API 함수이다.) -> 콜스택 push
    3. callback함수(sayBye)의 호출 스케줄링(호출타이머 설정, 콜백함수의 등록) -> setTimeout 실행 컨텍스트 제거 

    4. `4-1` 과 `4-2` 가 병행으로 처리됩니다.
      4-1. 브라우저가 타이머를 설정 타이머가 만료되면 callback 함수를 콜스택 -> 태스크큐로 push 후 대기상태로 전환 (자바스크립트 엔진 x , 브라우저가 이를 수행)
      4-2. 자바스크립트 엔진에 의해 sayHello 함수를 평가 -> sayHello 함수 실행 컨텍스트 생성 -> 콜스택 push -> 내부 코드 실행 후 제거

    5. 콜스택은 비어진 상태이고 태스크 큐에는 sayBye라는 callback함수가 대기하고 있는 상태 -> 이벤트 루프에 의해 콜스택으로 이동
    6. 자바스크립트 엔진에 의해 콜스택의 sayBye함수 평가, 실행컨텍스트 생성, push, 제거

<br>

### 1-4 자바스크립트의 비동기 프로그래밍 요약
- 자바스크립트는 기본적으로 하나의 태스크 만을 처리할 수 있는 __싱글 스레드__ 로 동작하는 __동기적__ 언어이다.
- 그렇다고 __비동기적__ 으로 동작하는 것이 불가능한 것은 아니다. 브라우저 또는 Node.js의 도움을 받아 __비동기적 프로그래밍__ 으로 동작하게 할 수 있다.
- __자바스크립트엔진__(콜스택, 힙) + __브라우저__(태스크 큐, 이벤트 루프, Web API)의 조합을 통해서 가능하다.
